---
alwaysApply: false
priority: HIGH
glob: "*ToCSharpViewModel*"
---

# VIEWMODEL LAYER RULES

## Project Structure
- Location: `FRONT/{ProgramName}Model/` and `FRONT/{ProgramName}FrontResources/`
- Target: `netstandard2.1`
- Purpose: ViewModels, resources

## Resource Files
- Location: Root folder of FrontResources project
- Files: `{ProgramName}FrontResources_msgrsc.resx` (English), `{ProgramName}FrontResources_msgrsc.id.resx` (Indonesian)
- Pattern: `R_FrontUtility.R_GetError(typeof(Resources_Dummy_Class), pcErrorId)`

## ViewModel Rules
- Location: `{ProgramName}Model/VMs/` folder
- All methods accept parameters (no R_FrontGlobalVar usage)
- List methods use `R_FrontContext.R_SetStreamingContext()` pattern
- Public properties use PascalCase (no underscore prefix)
- Private fields use `_snakeCase` (no type prefix)
- **CRITICAL**: Model initialization pattern: `private readonly FAM00100Model _model = new FAM00100Model();`

## Data Validation Rules - CRITICAL
- **All validation logic MUST be in ViewModel**, never in Razor code-behind
- **Validation methods return `R_Exception`** for consistent error handling
- **Validation methods accept DTO parameters** for validation
- **Resource-based error messages** using `R_FrontUtility.R_GetError()`
- **Validation covers all business rules** and data integrity checks

### Validation Method Pattern
- **Method signature**: `public R_Exception Validate{EntityName}({EntityDTO} poEntity)`
- **Return type**: `R_Exception` (not void)
- **Parameter**: Entity DTO to validate
- **Error handling**: Use `loEx.Add("", "ErrorKey")` for validation errors
- **Resource messages**: All error messages from resource files

### Validation Integration Rules
- **Code-behind calls ViewModel validation** methods
- **No inline validation** in Razor event handlers
- **Validation results** passed back through `R_Exception`
- **Consistent error handling** across all validation scenarios

## When CRUD Methods Are Needed
- **Form-level CRUD**: ViewModels with `R_Conductor` (main forms)
- **Grid-level CRUD**: ViewModels with `R_Grid` that have Add/Edit/Delete operations
- **Inquiry-only**: ViewModels for read-only grids (no CRUD needed)

### Date Handling
- If data return DateString fields (e.g., `C*_DATE`) → nullable `DateTime` (`D*_DATE`) in `*ViewModel.cs`
- Date format: `'yyyyMMdd'` unless otherwise specified in `*ViewModel.cs`
- `R_DatePicker` binds to `D*_DATE` in `*.razor`

## Violations
- ❌ Using R_FrontGlobalVar in ViewModels
- ❌ Returning collections instead of populating properties
- ❌ Data state in Razor.cs instead of ViewModel
- ❌ Business logic in Front project
- ❌ **CRITICAL**: Not inheriting from R_ViewModel<T>
- ❌ **CRITICAL**: Declaring Data property manually (it's inherited)
- ❌ **CRITICAL**: Wrong resource file naming convention
- ❌ **CRITICAL**: Missing R_BlazorFrontEnd namespace for R_ViewModel<T>
- ❌ **CRITICAL**: Assigning to Data property (it's read-only), use separate properties for CRUD results (not Data property)
- ❌ **CRITICAL**: Missing CRUD methods for ViewModels with grids/conductors
- ❌ **CRITICAL**: Not using separate properties for CRUD results
- ❌ **CRITICAL**: Validation logic in Razor code-behind instead of ViewModel
- ❌ **CRITICAL**: Validation methods returning void instead of R_Exception
- ❌ **CRITICAL**: Hardcoded error messages instead of resource-based messages
- ❌ **CRITICAL**: Missing validation methods for CRUD operations