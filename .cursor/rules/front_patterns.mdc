---
alwaysApply: false
priority: HIGH
glob: "*ToCSharpFront*"
---

# FRONTEND LAYER PATTERNS

## DI Integrations

### Global Variable (IClientHelper)
```csharp
// ✅ CORRECT using statement
using BlazorClientHelper;

// ✅ CORRECT injection
[Inject] private IClientHelper ClientHelper { get; set; } = default!;
```

### Localizer Integration
```csharp
// ✅ CORRECT using statement
using R_BlazorFrontEnd.Interfaces;

// ✅ CORRECT injection
[Inject] private R_ILocalizer<{ProgramName}FrontResources.Resources_Dummy_Class> Localizer { get; set; } = default!;
```

### MessageBoxService
```csharp
// ✅ CORRECT using statement
using R_BlazorFrontEnd.Controls.MessageBox;

// ✅ CORRECT injection
[Inject] private R_MessageBoxService MessageBoxService { get; set; } = default!;

// ✅ CORRECT usage
await MessageBoxService.Show("Error", Localizer["PS003"], R_eMessageBoxButtonType.OK);

// ✅ CORRECT usage
var result = await MessageBoxService.Show("Title", "Message", R_eMessageBoxButtonType.YesNo);
if (result == R_eMessageBoxResult.Yes)
{
    // Handle Yes
}
```
#### Available MessageBox Button Types
Based on R_MessageBoxContainer.razor:
- `R_eMessageBoxButtonType.OK` - Shows OK button only
- `R_eMessageBoxButtonType.OKCancel` - Shows OK and Cancel buttons
- `R_eMessageBoxButtonType.YesNo` - Shows Yes and No buttons
- `R_eMessageBoxButtonType.YesNoCancel` - Shows Yes, No, and Cancel buttons

#### Available MessageBox Results
- `R_eMessageBoxResult.OK` - User clicked OK
- `R_eMessageBoxResult.Yes` - User clicked Yes
- `R_eMessageBoxResult.No` - User clicked No
- `R_eMessageBoxResult.Cancel` - User clicked Cancel or closed dialog

## Using Patterns in _Imports.razor (minimal)
**CRITICAL:** All using statements MUST be in _Imports.razor, NOT in .razor files
```razor
<!-- ✅ CORRECT - In _Imports.razor -->
@using Microsoft.AspNetCore.Components.Web
@using R_BlazorFrontEnd.Controls.Base
@using R_BlazorFrontEnd.Controls
@using R_BlazorFrontEnd.Controls.Layouts
@using R_BlazorFrontEnd.Interfaces
@using R_BlazorFrontEnd.Controls.Grid.Columns
@using R_BlazorFrontEnd.Controls.Forms
@using R_BlazorFrontEnd.Controls.Attributes
@using R_BlazorFrontEnd.Controls.DataControls
@using R_BlazorFrontEnd.Controls.Enums
@using R_BlazorFrontEnd.Controls.Events
@using R_BlazorFrontEnd.Controls.MessageBox
@using R_BlazorFrontEnd.Helpers
@using R_BlazorFrontEnd.Exceptions
@using R_CommonFrontBackAPI
@using BlazorClientHelper
@using FAI00130Model.VMs
@using FAI00130Common.DTOs
@using FAI00130FrontResources
```

## UI Architecture Patterns - CRITICAL

### Data Validation Pattern
**RULE**: All data validation logic MUST be in ViewModel, not in Razor code-behind

#### ✅ CORRECT - ViewModel Validation
```csharp
// In ViewModel
public R_Exception ValidateTaxCategory(FAM00300DTO poEntity)
{
    var loEx = new R_Exception();

    // Validate Tax Category Code
    if (string.IsNullOrWhiteSpace(poEntity.CTAX_CATEGORY_CODE))
    {
        loEx.Add(R_FrontUtility.R_GetError(typeof(FAM00300FrontResources.Resources_Dummy_Class), "PS001"));
    }

    // Validate Tax Type
    if (string.IsNullOrWhiteSpace(poEntity.CTAX_TYPE))
    {
        loEx.Add(R_FrontUtility.R_GetError(typeof(FAM00300FrontResources.Resources_Dummy_Class), "PS002"));
    }

    // Validate Tax Category Description
    if (string.IsNullOrWhiteSpace(poEntity.CTAX_CATEGORY_DESC))
    {
        loEx.Add(R_FrontUtility.R_GetError(typeof(FAM00300FrontResources.Resources_Dummy_Class), "PS003"));
    }

    return loEx;
}
```

#### ✅ CORRECT - Code-behind Usage
```csharp
// In Razor.cs - Only calls ViewModel validation
private void Grid_R_Validation(R_ValidationEventArgs eventArgs)
{
    var loEx = new R_Exception();

    try
    {
        var loData = R_FrontUtility.ConvertObjectToObject<FAM00300DTO>(eventArgs.Data) ?? new();

        // Use ViewModel validation
        var loValidationEx = _fam00300ViewModel.ValidateTaxCategory(loData);
        loEx.Add(loValidationEx);
    }
    catch (Exception ex)
    {
        loEx.Add(ex);
    }

    loEx.ThrowExceptionIfErrors();
}
```

### Project Configuration Pattern
**RULE**: Must follow exact template structure for .csproj files

#### ❌ WRONG - Missing Required Elements
```xml
<!-- ❌ WRONG - Missing SupportedPlatform -->
<Project Sdk="Microsoft.NET.Sdk.Razor">
	<PropertyGroup>
		<TargetFramework>net6.0</TargetFramework>
		<LangVersion>10.0</LangVersion>
		<Nullable>enable</Nullable>
		<ImplicitUsings>disable</ImplicitUsings>
	</PropertyGroup>
	<!-- Missing <SupportedPlatform Include="browser" /> -->
</Project>

<!-- ❌ WRONG - Wrong SDK -->
<Project Sdk="Microsoft.NET.Sdk">
	<!-- Wrong SDK for Blazor components -->
</Project>
```

## COLUMN LAYOUT VALIDATION - MANDATORY
**CRITICAL:** Each R_StackLayout Row must have column sum ≤ 12

### Correct Pattern
```razor
<!-- ✅ CORRECT - Each row sums to ≤ 12 -->
<R_StackLayout>
    <!-- Row 1: 2 + 1 + 1 + 4 = 8 columns ✅ -->
    <R_StackLayout Row="true">
        <R_ItemLayout col="2">Label</R_ItemLayout>
        <R_ItemLayout col="1">TextBox</R_ItemLayout>
        <R_ItemLayout col="1">Button</R_ItemLayout>
        <R_ItemLayout col="4">Description</R_ItemLayout>
    </R_StackLayout>
    
    <!-- Row 2: 2 + 1 + 1 + 2 = 6 columns ✅ -->
    <R_StackLayout Row="true">
        <R_ItemLayout col="2">Label</R_ItemLayout>
        <R_ItemLayout col="1">ComboBox</R_ItemLayout>
        <R_ItemLayout col="1">NumericTextBox</R_ItemLayout>
        <R_ItemLayout col="2">Button</R_ItemLayout>
    </R_StackLayout>
</R_StackLayout>
```

### Wrong Pattern
```razor
<!-- ❌ WRONG - Single R_StackLayout with Row="true" -->
<R_StackLayout Row="true">
    <R_ItemLayout col="2">Label</R_ItemLayout>
    <R_ItemLayout col="1">TextBox</R_ItemLayout>
    <R_ItemLayout col="1">Button</R_ItemLayout>
    <R_ItemLayout col="4">Description</R_ItemLayout>
    <!-- This creates one long row instead of separate rows -->
</R_StackLayout>
```

### Requirements
- **Nested R_StackLayout** - Use individual `R_StackLayout Row="true"` for each row
- **Column validation** - Sum of col values per row ≤ 12
- **Last R_ItemLayout** - Use `auto="false"` to prevent overflow

### Violations
- ❌ Using single R_StackLayout Row="true" for multiple rows
- ❌ Column sum exceeding 12 in any row
- ❌ Not using nested R_StackLayout for proper row separation

## Component Patterns

### R_ComboBox
```razor
<R_ComboBox Data="@viewModel.DataList"
            @bind-Value="@viewModel.SelectedValue"
            ValueField="@nameof(DTO.PropertyName)"
            TextField="@nameof(DTO.DisplayName)">
</R_ComboBox>
```

### R_Grid Inquiry
```razor
<R_Grid @ref="@_gridRef"
        DataSource="@viewModel.DataList"
        R_GridType="@R_eGridType.Original"
        R_ServiceGetListRecord="@Grid_ServiceGetListRecord">
    <R_GridColumns>
        <R_GridTextColumn FieldName="@nameof(DTO.Property)" HeaderText="Header"></R_GridTextColumn>
    </R_GridColumns>
</R_Grid>
```

### R_Grid CRUD in From with Conductor
```razor
<R_Grid @ref="@_gridRef"
        DataSource="@viewModel.DataList"
        R_ConductorSource="@_conductorRef"
        R_GridType="@R_eGridType.Navigator"
        R_ServiceGetListRecord="@Grid_ServiceGetListRecord">
    <R_GridColumns>
        <R_GridTextColumn FieldName="@nameof(DTO.Property)" HeaderText="Header"></R_GridTextColumn>
    </R_GridColumns>
</R_Grid>
```

## R_Grid CRUD in Grid with ConductorGrid
```razor
<R_Grid @ref="@_gridRef"
        DataSource="@viewModel.DataList"
        R_ConductorGridSource="@_conductorGridRef"
        R_GridType="@R_eGridType.Original"
        R_ServiceGetListRecord="@Grid_ServiceGetListRecord">
    <R_GridColumns>
        <R_GridTextColumn FieldName="@nameof(DTO.Property)" HeaderText="Header"></R_GridTextColumn>
    </R_GridColumns>
</R_Grid>
```

### R_Button Pattern
```razor
<R_Button OnClick="OnClicked">
    @Localizer["btn"]
</R_Button>
```

### R_Lookup Pattern
```razor
<R_ItemLayout auto="true">
    <R_Lookup R_ConductorSource="@_conductorRef"
              R_Before_Open_Lookup="R_Before_Open_Lookup"
              R_After_Open_Lookup="R_After_Open_Lookup">
        ...
    </R_Lookup>
</R_ItemLayout>
```

## Navigation Components CORRECT USAGE
### Rules
- **MUST**: Use the correct navigation component based on purpose
- `R_PredefinedDock`: Shown on page load, cannot close
- `R_Detail`: On click, can close
- `R_Popup`: For R_Page components in modals ONLY
- `R_Lookup`: For lookup pattern (selecting records)
- `R_Find`: For finding/selecting records
- MessageBox: Use `MessageBoxService`, NOT `R_Popup`
- **NEVER use R_Button for navigation**
- **VIOLATIONS:** Reject code, explain correct component

### Event Arguments Properties (CRITICAL)
**Available Properties in BeforeOpen Events:**

**For R_InstantiateDockEventArgs and R_BeforeOpenTabPageEventArgs:**
- `TargetPageType` - Type of the page to open (use when referencing pages in same project)
- `Parameter` - Object to pass to R_Page.R_Init_From_Master(object? poParameter) (optional)
- `FormAccess` - Override form access (rarely used)
- `Cancel` - Cancel the operation (R_InstantiateDockEventArgs only)

**For R_BeforeOpenModalEventArgsBase (Detail, Popup, Lookup, Find):**
- `TargetPageType` - Type of the page to open (use when referencing pages in same project)
- `PageNamespace` - Namespace of the page to open (PREFERRED - use when referencing .razor in other front projects)
- `Parameter` - Object to pass to R_Page.R_Init_From_Master(object? poParameter) (optional)
- `PageTitle` - Override page title (rarely used)
- `FormAccess` - Override form access (rarely used)

**Available Properties in AfterOpen Events:**
- `Result` - Return value from the navigation component (can be any logic, not just conductor data)
- `Success` - Success status (R_AfterOpenPopupEventArgs only)

### 1. R_PredefinedDock - For tabs shown on page load, cannot be closed
```razor
<R_PredefinedDock R_InstantiateDock="@R_InstantiateDock"
                  Title="Predefined Dock Title"
                  R_AfterOpenPredefinedDock="R_AfterOpenPredefinedDock" />
```

```csharp
private void R_InstantiateDock(R_InstantiateDockEventArgs eventArgs)
{
    // R_InstantiateDockEventArgs does NOT have PageNamespace - only TargetPageType
    eventArgs.TargetPageType = typeof(SubProgramPage);
    
    // Optional: Pass parameter to R_Page.R_Init_From_Master()
    eventArgs.Parameter = _conductorRef.R_GetCurrentData();
}

private async Task R_AfterOpenPredefinedDock(R_AfterOpenPredefinedDockEventArgs eventArgs)
{
    if (eventArgs.Result is null) return;
    // You can do any logic here, not just conductor data
    await _conductorRef.R_SetCurrentData(eventArgs.Result);
}
```

### 2. R_Detail - For tabs shown on click, can be closed
```razor
<R_Detail R_Before_Open_Detail="@R_Before_Open_Detail"
          R_After_Open_Detail="@R_After_Open_Detail">
    Detail Text
</R_Detail>
```

```csharp
private void R_Before_Open_Detail(R_BeforeOpenDetailEventArgs eventArgs)
{
    // PREFERRED: Use PageNamespace for referencing .razor in other front projects
    eventArgs.PageNamespace = "OtherProject.Pages.DetailPage";
    // OR use TargetPageType for pages in same project
    // eventArgs.TargetPageType = typeof(DetailPage);
    
    // Optional: Pass parameter to R_Page.R_Init_From_Master()
    eventArgs.Parameter = _conductorRef.R_GetCurrentData();
}

private async Task R_After_Open_Detail(R_AfterOpenDetailEventArgs eventArgs)
{
    if (eventArgs.Result is null) return;
    // You can do any logic here, not just conductor data
    await _conductorRef.R_SetCurrentData(eventArgs.Result);
}
```

### 3. R_Popup - For showing R_Page components in modal windows

```razor
<R_Popup R_Before_Open_Popup="@R_Before_Open_Popup"
         R_After_Open_Popup="@R_After_Open_Popup"
         >Popup Text</R_Popup>
```

```csharp
public void R_Before_Open_Popup(R_BeforeOpenPopupEventArgs eventArgs)
{
    // PREFERRED: Use PageNamespace for referencing .razor in other front projects
    eventArgs.PageNamespace = "OtherProject.Pages.PopupPage";
    // OR use TargetPageType for pages in same project
    // eventArgs.TargetPageType = typeof(PopupPage);
    
    // Optional: Pass parameter to R_Page.R_Init_From_Master()
    eventArgs.Parameter = _conductorRef?.R_GetCurrentData();
}

public async Task R_After_Open_Popup(R_AfterOpenPopupEventArgs eventArgs)
{
    if (!eventArgs.Success || eventArgs.Result is null) return;
    // You can do any logic here, not just conductor data
    if (_conductorRef is not null)
        await _conductorRef.R_SetCurrentData(eventArgs.Result);
    // For grid refresh after upload operations
    if (_gridRef is not null)
        await _gridRef.R_RefreshGrid(null);
}
```

### 4. R_Lookup - For lookup pattern (selecting records)
```razor
<R_Lookup R_Before_Open_Lookup="@R_Before_Open_Lookup"
          R_After_Open_Lookup="@R_After_Open_Lookup"
          >Lookup Text</R_Lookup>
```

```csharp
private void R_Before_Open_Lookup(R_BeforeOpenLookupEventArgs eventArgs)
{
    // PREFERRED: Use PageNamespace for referencing .razor in other front projects
    eventArgs.PageNamespace = "OtherProject.Pages.LookupPage";
    // OR use TargetPageType for pages in same project
    // eventArgs.TargetPageType = typeof(LookupPage);
    
    // Optional: Pass parameter to R_Page.R_Init_From_Master()
    eventArgs.Parameter = "Dari Lookup";
    
    // Rarely used: Override page title
    // eventArgs.PageTitle = "Title dari event argument";
}

public async Task R_After_Open_Lookup(R_AfterOpenLookupEventArgs eventArgs)
{
    if (eventArgs.Result is null) return;
    // You can do any logic here, not just conductor data
    await _conductorRef.R_SetCurrentData(eventArgs.Result);
}
```

### 5. R_Find - For finding/selecting records
```razor
<R_Find R_FindModel="@R_FindModel" // This is to change caller R_Page Access (OPTIONAL)
        R_Before_Open_Find="@R_Before_Open_Find"
        R_After_Open_Find="@R_After_Open_Find"
        >Find Text</R_Find>
```

```csharp
private void R_Before_Open_Find(R_BeforeOpenFindEventArgs eventArgs)
{
    // PREFERRED: Use PageNamespace for referencing .razor in other front projects
    eventArgs.PageNamespace = "OtherProject.Pages.FindPage";
    // OR use TargetPageType for pages in same project
    // eventArgs.TargetPageType = typeof(FindPage);
    
    // Optional: Pass parameter to R_Page.R_Init_From_Master()
    eventArgs.Parameter = "Dari Find";
    
    // Rarely used: Override page title
    // eventArgs.PageTitle = "Title dari event argument";
}

private void R_FindModel(R_FindModelEventArgs eventArgs)
{
    eventArgs.FindModel = R_eFindModel.Normal; // or NoDisplay, ViewOnly
}

public async Task R_After_Open_Find(R_AfterOpenFindEventArgs eventArgs)
{
    if (eventArgs.Result == null) return;
    // You can do any logic here, not just conductor data
    var loData = (ProductDTO)eventArgs.Result;
    await _conductorRef.R_SetCurrentData(loData);
}
```

### 6. R_TabPage - For tab navigation within same page
```razor
<R_TabStrip>
    <R_TabStripTab Title="Tab 1">
        <!-- Content -->
    </R_TabStripTab>
    <R_TabStripTab Title="Tab 2">
        <R_TabPage R_After_Open_TabPage="R_After_Open_TabPage" 
                   R_Before_Open_TabPage="R_Before_Open_TabPage"></R_TabPage>
    </R_TabStripTab>
</R_TabStrip>
```

```csharp
private void R_Before_Open_TabPage(R_BeforeOpenTabPageEventArgs eventArgs)
{
    // R_BeforeOpenTabPageEventArgs does NOT have PageNamespace - only TargetPageType
    eventArgs.TargetPageType = typeof(TabPage);
    
    // Optional: Pass parameter to R_Page.R_Init_From_Master()
    var loParam = _conductorRef.R_GetCurrentData();
    eventArgs.Parameter = loParam;
}

private async Task R_After_Open_TabPage(R_AfterOpenTabPageEventArgs eventArgs)
{
    if (eventArgs.Result is null) return;
    // You can do any logic here, not just conductor data
    await _conductorRef.R_SetCurrentData(eventArgs.Result);
}
```

#### 7. Service-Based Navigation (Alternative to R_Button)
```csharp
[Inject] public R_PopupService PopupService { get; set; }
[Inject] public R_LookupService LookupService { get; set; }

// Popup from service
private async Task popupButtonOnClick()
{
    var loPopupSettings = new R_PopupSettings
    {
        PageTitle = "Custom Title Override Only",
        Page = this,
    };

    var loResult = await PopupService.Show(typeof(PopupPage), 
                                          _conductorRef.R_GetCurrentData(), 
                                          poPopupSettings: loPopupSettings);
    
    var loData = (ProductDTO)loResult.Result;
    await _conductorRef.R_SetCurrentData(loData);
}

// Lookup from service
private async Task lookupButtonOnClick()
{
    var loLookupSettings = new R_LookupSettings
    {
        PageTitle = "Custom Title Override Only",
        Page = this,
    };

    var loResult = await LookupService.Show(typeof(LookupPage), 
                                           "Dari LookupService", 
                                           loLookupSettings);
}
```

## Event Patterns 
### OnLostFocus / OnBlur Event Pattern (R_BlazorFrontEnd.Controls)
```razor
<!-- R_TextBox -->
<R_TextBox @bind-Value="@viewModel.FieldValue"
           OnLostFocused="OnFieldLostFocused"/>

<!-- R_ComboBox -->
<R_ComboBox Data="@viewModel.DataList"
            @bind-Value="@viewModel.SelectedValue"
            ValueField="@nameof(DTO.Code)"
            TextField="@nameof(DTO.Name)"
            OnLostFocused="OnComboBoxLostFocused"/>

<!-- R_NumericTextBox -->
<R_NumericTextBox TValue="int" 
                  @bind-Value="@viewModel.NumericValue"
                  OnLostFocused="OnNumericLostFocused"/>

<!-- R_Grid (Cell Events) -->
<R_Grid DataSource="@viewModel.DataList"
        R_CellLostFocused="@OnCellLostFocused">
</R_Grid>
```

**Event Handler Signatures:**
```csharp
// Input components
public async Task OnFieldLostFocused() { }

// Grid cell events
public async Task OnCellLostFocused(R_CellLostFocusedEventArgs eventArgs) { }
```

## Conductor

### Conductor Source DEPENDS on Control
- Grid CRUD operations: `R_ConductorGridSource="@_conductorGridRef"`
- Form access control: `R_ConductorSource="@_conductorRef"`
- No source: Component always enabled (independent functionality)
- **VIOLATIONS:** Explain correct usage, refuse wrong pattern

### R_CONDUCTOR USAGE - CRITICAL DISTINCTION
**CRITICAL:** R_Conductor is ONLY for CRUD operations, NOT for inquiry programs

#### When to Use R_Conductor
- **CRUD Programs:** Add, Edit, Delete, Save, Cancel operations
- **GridType.Navigator:** For grids with conductor-driven CRUD
- **Form Controls:** When you need Add/Edit/Delete buttons

#### When NOT to Use R_Conductor
- **Inquiry Programs:** Read-only data display (like FAI00120)
- **GridType.Original:** For inquiry-only grids
- **Simple Forms:** Just displaying and filtering data

#### R_Conductor Pattern
```csharp
// ONLY for CRUD programs
<R_Conductor @ref="@_conductorRef"
             R_ViewModel="@viewModel" // `R_ViewModel` parameter MUST be filled
             R_Display="Conductor_DisplayMethod"
             R_IsHeader="true"
             R_ServiceGetRecord="@Conductor_ServiceGetRecord">
</R_Conductor>
```

#### Inquiry Program Pattern (No Conductor)
```csharp
// For inquiry programs - NO R_Conductor needed
<R_Grid @ref="@_gridRef"
        DataSource="@viewModel.DataList"
        R_GridType="@R_eGridType.Original"
        R_ServiceGetListRecord="@Grid_ServiceGetListRecord">
</R_Grid>
```
**VIOLATIONS:** Using R_Conductor for inquiry programs, using GridType.Navigator without conductor