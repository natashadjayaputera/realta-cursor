---
alwaysApply: true
priority: CRITICAL
nonNegotiable: true
---

# CORE RULES - UNIVERSAL

## RULE 1: PLAN GENERATION
- Create a to do in plan generation, to save plan according to the format and procedure defined in `plan_generation.mdc`.
- No code generation is allowed before the plan is accepted and saved.

## RULE 2: DOCUMENTATION FIRST
- Check `.cursor/docs/net6/` for ALL target libraries before code generation
- Never guess class names, namespaces, or DLL references
- If unclear, ask user - never invent

## RULE 3: PROJECT STRUCTURE
```
BACK/{module}/{ProgramName}Back/           → Business Logic + Logger/Activity
├── DTOs/
│   ├── Logger{ProgramName}.cs            → R_NetCoreLoggerBase<Logger{ProgramName}>
│   └── {ProgramName}Activity.cs          → R_ActivitySourceBase
├── {ProgramName}Cls.cs                   → R_BusinessObjectAsync<{ProgramName}DTO>
└── {ProgramName}Back.csproj

BACK/{module}/{ProgramName}BackResources/ → Resources ONLY (root folder)
├── {ProgramName}BackResources_msgrsc.resx
├── {ProgramName}BackResources_msgrsc.id.resx
├── {ProgramName}BackResources_msgrsc.Designer.cs
├── Resources_Dummy_Class.cs
└── {ProgramName}BackResources.csproj

COMMON/{module}/{ProgramName}Common/      → DTOs + Interfaces ONLY
├── DTOs/ (all DTOs here)
├── I{ProgramName}.cs                     → R_IServiceCRUDAsyncBase<{ProgramName}DTO>
├── Requests/ (request DTOs)
└── {ProgramName}Common.csproj

SERVICE/{module}/{ProgramName}Service/    → API Controllers
├── {ProgramName}Controller.cs           → Implements I{ProgramName}
└── {ProgramName}Service.csproj

FRONT/{ProgramName}Model/                 → Service Client
├── {ProgramName}Model.cs                → Implements I{ProgramName}
├── VMs/ (view models)
└── {ProgramName}Model.csproj

FRONT/{ProgramName}FrontResources/        → Frontend Resources (root folder)
├── {ProgramName}FrontResources_msgrsc.resx
├── {ProgramName}FrontResources_msgrsc.id.resx
├── {ProgramName}FrontResources_msgrsc.Designer.cs
├── Resources_Dummy_Class.cs
└── {ProgramName}FrontResources.csproj

FRONT/{ProgramName}Front/                 → Blazor Frontend
├── {ProgramName}.razor
├── {ProgramName}.razor.cs
├── _Imports.razor
└── {ProgramName}Front.csproj
```

### Multi-Program Project Structure (CRITICAL)

### When Multiple Programs Share Same Module
**RULE**: Sub-programs (like SAM00110) should be integrated into the main program's project structure, NOT created as separate projects.

**CORRECT Structure:**
```
SAM00100Model/
├── SAM00100Model.cs          → Main program model
├── SAM00110Model.cs          → Sub-program model (same project)
└── VMs/
    ├── SAM00100ViewModel.cs  → Main program view model
    ├── SAM00110ViewModel.cs  → Sub-program view model (same project)
    └── SAM00100UploadViewModel.cs → Upload view model

SAM00100FrontResources/
├── SAM00100FrontResources_msgrsc.resx     → Contains ALL resources
├── SAM00100FrontResources_msgrsc.id.resx  → Contains ALL resources
└── Resources_Dummy_Class.cs

SAM00100Front/
├── SAM00100.razor           → Main program page
├── SAM00110.razor           → Sub-program page (same project)
├── SAM00100Upload.razor     → Upload page (same project)
└── SAM00100Front.csproj     → References ALL components
```

**WRONG Structure:**
```
❌ SAM00100Model/ (separate)
❌ SAM00110Model/ (separate) 
❌ SAM00100FrontResources/ (separate)
❌ SAM00110FrontResources/ (separate)
```

## RULE 4: BUSINESS LOGIC PRESERVATION
- **NEVER** modify SQL queries or stored procedure names
- **NEVER** change business logic calculations
- Replicate VB.NET logic exactly (even bugs)
- **NEVER** change data types from VB.NET conventions (e.g., "I" prefix = int, not short)

## RULE 5: VARIABLE NAMING STANDARD
- `[Inject]` properties: `private IType PropertyName { get; set; } = default!;` (PascalCase)
- Private properties: `private Type _propertyName;` (underscore + snake_case, NO type prefix)
- Public properties: `public Type PropertyName { get; set; }` (PascalCase)
- Local variables: `Type l{typePrefix}VariableName;` (always)
- Method parameters: `Type p{typePrefix}ParameterName;`
- **VIOLATIONS:** Correct immediately or refuse to proceed

### Type-Specific Prefixes
- **"c"** for string (char/string)
- **"l"** for boolean (logical)
- **"i"** for int (integer, short, long, etc)
- **"n"** for decimal (numeric)
- **"d"** for DateTime (date)
- **"e"** for enum
- **"o"** for objects and others

## RULE 6: BUILD VALIDATION
- Build after ANY code changes
- Report ALL errors verbatim
- Fix or ask user after 3 attempts

## RULE 7: ERROR HANDLING
- Use `var loEx = new R_Exception();` pattern
- All error messages from resource files
- Never hardcode error messages

```csharp
public async Task MethodName()
{
    var loEx = new R_Exception();
    
    try
    {
        // Your code here
    }
    catch (Exception ex)
    {
        loEx.Add(ex);
    }
    
    loEx.ThrowExceptionIfErrors();
}
```

---

# ENFORCEMENT
When rules violated:
1. Stop code generation immediately
2. Cite specific rule number
3. Explain violation
4. Ask for user confirmation before proceeding