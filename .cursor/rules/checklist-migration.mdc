---
alwaysApply: true
---

# MIGRATION CHECKLIST - Use for every new program

## Pre-Migration
- [ ] Read `.cursor/docs/net6/` for all target libraries
- [ ] Review `.cursor/docs/net4/` for original patterns (reference only)
- [ ] Check `critical-patterns-learned.md` for .NET 6 structure
- [ ] Identify all Stored Procedures and SQL queries (MUST NOT change)

## Project 1: {ProgramName}Common
- [ ] All DTOs moved to Common project
- [ ] All enums consolidated here
- [ ] Interface `I{ProgramName}` using `R_IServiceCRUDAsyncBase`
- [ ] Request/Parameter DTOs created
- [ ] Result DTOs created
- [ ] No business logic in Common

## Project 2: {ProgramName}BackResources
- [ ] Created in root: `BACK/{module}/{ProgramName}BackResources/`
- [ ] All error message keys defined (e.g., `ERR_INVALID_COMPANY_ID`)
- [ ] All success messages defined
- [ ] Default `.resx` file (English)
- [ ] Indonesian `.id.resx` file
- [ ] `Resources_Dummy_Class.cs` created
- [ ] No code logic in this project

## Project 3: {ProgramName}Back
- [ ] `Logger{ProgramName}` class inheriting `R_NetCoreLoggerBase` (Back only)
- [ ] `{ProgramName}Activity` class inheriting `R_ActivitySourceBase` (Back only)
- [ ] `{ProgramName}Cls` class inheriting `R_BusinessObjectAsync`
- [ ] All methods using correct database pattern with `using var`
- [ ] All methods logging start/end with method name
- [ ] All exception messages from resources (via `GetError()`)
- [ ] No SQL text modified
- [ ] No SP names changed
- [ ] All parameters passed using `loDb.R_AddCommandParameter()`

## Project 4: {ProgramName}Service
- [ ] `{ProgramName}Controller` inheriting `ControllerBase, I{ProgramName}`
- [ ] Logger initialized in constructor
- [ ] Activity source initialized in constructor
- [ ] All methods decorated with `[HttpPost]`
- [ ] Route pattern: `[Route("api/[controller]/[action]")]`
- [ ] List methods returning `async IAsyncEnumerable<>`
- [ ] Other methods returning `async Task<{ProgramName}ResultDTO<>>`
- [ ] Using `R_BackGlobalVar.COMPANY_ID` for IClientHelper data
- [ ] Using `R_Utility.R_GetStreamingContext()` for custom parameters
- [ ] R_APIBackEnd reference added to .csproj
- [ ] Using correct Microsoft.NET.Sdk + FrameworkReference (not Web SDK)

## Project 5: {ProgramName}FrontResources
- [ ] Created in root: `FRONT/{ProgramName}FrontResources/`
- [ ] All UI labels and messages defined
- [ ] All validation messages defined
- [ ] Default `.resx` file (English)
- [ ] Indonesian `.id.resx` file
- [ ] `Resources_Dummy_Class.cs` created

## Project 6: {ProgramName}Model
- [ ] `{ProgramName}Model` class inheriting `R_BusinessObjectServiceClientBase`
- [ ] Constants: `DEFAULT_HTTP_NAME`, `DEFAULT_SERVICEPOINT_NAME`, `DEFAULT_MODULE`
- [ ] Interface methods implemented
- [ ] List methods with `IAsyncEnumerable` return (interface compliance)
- [ ] List async methods with `Task<ResultDTO<List<>>>` return (actual implementation)
- [ ] Using `R_HTTPClientWrapper.R_APIRequestStreamingObject<>()`
- [ ] Using `R_HTTPClientWrapper.R_APIRequestObject<>()`

## Project 7: {ProgramName}Front
- [ ] `{ProgramName}.razor` main page created
- [ ] `{ProgramName}.razor.cs` code-behind created
- [ ] All components using correct navigation patterns
- [ ] Conductor source correctly assigned (Grid/Form/None)
- [ ] IClientHelper injected in code-behind (not in ViewModel)
- [ ] All resource strings using `@_localizer["key"]`

## Project 8: ViewModels
- [ ] All ViewModels in `{ProgramName}Model/VMs/` folder
- [ ] All methods accepting parameters (no R_FrontGlobalVar usage)
- [ ] List methods using `R_FrontContext.R_SetStreamingContext()` pattern
- [ ] Error handling with `R_Exception`
- [ ] Logging where appropriate
- [ ] Public properties using CamelCase (no underscore prefix)
- [ ] Private fields using `_snakeCase` (no type prefix)

## .CSPROJ VALIDATION (Rule #22 - MUST COMPLETE BEFORE BUILD)

**Verify ALL projects have exact PropertyGroup settings:**

### Common Project .csproj
```xml
<PropertyGroup>
  <TargetFramework>netstandard2.1</TargetFramework>
  <LangVersion>10.0</LangVersion>
  <Nullable>enable</Nullable>
  <ImplicitUsings>disable</ImplicitUsings>
</PropertyGroup>
```
Status: [ ] ✓ VERIFIED

### Back Project .csproj
```xml
<PropertyGroup>
  <TargetFramework>net6.0</TargetFramework>
  <LangVersion>10.0</LangVersion>
  <Nullable>enable</Nullable>
  <ImplicitUsings>disable</ImplicitUsings>
</PropertyGroup>
```
Status: [ ] ✓ VERIFIED

### BackResources Project .csproj
```xml
<PropertyGroup>
  <TargetFramework>netstandard2.1</TargetFramework>
  <LangVersion>10.0</LangVersion>
  <Nullable>enable</Nullable>
  <ImplicitUsings>disable</ImplicitUsings>
</PropertyGroup>
```
Status: [ ] ✓ VERIFIED

### Service Project .csproj
```xml
<PropertyGroup>
  <TargetFramework>net6.0</TargetFramework>
  <LangVersion>10.0</LangVersion>
  <Nullable>enable</Nullable>
  <ImplicitUsings>disable</ImplicitUsings>
</PropertyGroup>

<ItemGroup>
  <FrameworkReference Include="Microsoft.AspNetCore.App" />
</ItemGroup>
```
Status: [ ] ✓ VERIFIED

### Model Project .csproj
```xml
<PropertyGroup>
  <TargetFramework>netstandard2.1</TargetFramework>
  <LangVersion>10.0</LangVersion>
  <Nullable>enable</Nullable>
  <ImplicitUsings>disable</ImplicitUsings>
</PropertyGroup>
```
Status: [ ] ✓ VERIFIED

### FrontResources Project .csproj
```xml
<PropertyGroup>
  <TargetFramework>netstandard2.1</TargetFramework>
  <LangVersion>10.0</LangVersion>
  <Nullable>enable</Nullable>
  <ImplicitUsings>disable</ImplicitUsings>
</PropertyGroup>
```
Status: [ ] ✓ VERIFIED

### Front Project .csproj (Blazor)
```xml
<PropertyGroup>
  <TargetFramework>net6.0</TargetFramework>
  <LangVersion>10.0</LangVersion>
  <Nullable>enable</Nullable>
  <ImplicitUsings>disable</ImplicitUsings>
</PropertyGroup>
```
Status: [ ] ✓ VERIFIED

**ALL .csproj files must be verified BEFORE attempting build.**

## DLL REFERENCE VALIDATION (Rule #23 - CRITICAL)

**All R_* library references MUST use HintPath file references, NOT PackageReference:**

### ✅ CORRECT - HintPath Reference Pattern
```xml
<ItemGroup>
  <Reference Include="R_APIBackEnd">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APIBackEnd.dll</HintPath>
  </Reference>
  <Reference Include="R_CommonFrontBackAPI">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_CommonFrontBackAPI.dll</HintPath>
  </Reference>
</ItemGroup>
```

### ❌ WRONG - PackageReference Pattern
```xml
<ItemGroup>
  <PackageReference Include="R_APIBackEnd" Version="1.0.0" />
  <PackageReference Include="R_CommonFrontBackAPI" Version="1.0.0" />
</ItemGroup>
```

**Validation Checklist:**
- [ ] All R_* libraries use `<Reference Include="LibraryName">` with `<HintPath>`
- [ ] NO PackageReference entries for R_* libraries
- [ ] HintPath points to correct SYSTEM\SOURCE\LIBRARY directory
- [ ] Back libraries point to `LIBRARY\Back\` folder
- [ ] Front libraries point to `LIBRARY\Front\` folder
- [ ] Menu libraries point to `LIBRARY\Menu\` folder
- [ ] Relative path depth matches project location (../../../../..)

**MINIMAL DLL References by Project Type:**

### Common Project (netstandard2.1)
```xml
<ItemGroup>
  <Reference Include="R_APICommonDTO">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APICommonDTO.dll</HintPath>
  </Reference>
  <Reference Include="R_CommonFrontBackAPI">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_CommonFrontBackAPI.dll</HintPath>
  </Reference>
</ItemGroup>
```

### BackResources Project (netstandard2.1)
```xml
<!-- NO DLL references needed - resources only -->
```

### Back Project (net6.0)
```xml
<ItemGroup>
  <Reference Include="R_APIBackEnd">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APIBackEnd.dll</HintPath>
  </Reference>
  <Reference Include="R_APICommon">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APICommon.dll</HintPath>
  </Reference>
  <Reference Include="R_APICommonDTO">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APICommonDTO.dll</HintPath>
  </Reference>
  <Reference Include="R_CommonFrontBackAPI">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_CommonFrontBackAPI.dll</HintPath>
  </Reference>
  <Reference Include="R_OpenTelemetry">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_OpenTelemetry.dll</HintPath>
  </Reference>
</ItemGroup>
```

### Service Project (net6.0)
```xml
<ItemGroup>
  <Reference Include="R_APIBackEnd">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APIBackEnd.dll</HintPath>
  </Reference>
  <Reference Include="R_APICommon">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APICommon.dll</HintPath>
  </Reference>
  <Reference Include="R_APIStartUp">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APIStartUp.dll</HintPath>
  </Reference>
  <Reference Include="R_CommonFrontBackAPI">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_CommonFrontBackAPI.dll</HintPath>
  </Reference>
  <Reference Include="R_OpenTelemetry">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_OpenTelemetry.dll</HintPath>
  </Reference>
</ItemGroup>
```

### FrontResources Project (netstandard2.1)
```xml
<!-- NO DLL references needed - resources only -->
```

### Model Project (netstandard2.1)
```xml
<ItemGroup>
  <Reference Include="R_APIClient">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_APIClient.dll</HintPath>
  </Reference>
  <Reference Include="R_APICommonDTO">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_APICommonDTO.dll</HintPath>
  </Reference>
  <Reference Include="R_BusinessObjectFront">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_BusinessObjectFront.dll</HintPath>
  </Reference>
  <Reference Include="R_CommonFrontBackAPI">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_CommonFrontBackAPI.dll</HintPath>
  </Reference>
  <Reference Include="R_BlazorFrontEnd">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_BlazorFrontEnd.dll</HintPath>
  </Reference>
  <Reference Include="R_ContextFrontEnd">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_ContextFrontEnd.dll</HintPath>
  </Reference>
</ItemGroup>
```

### Front Project (net6.0 Blazor)
```xml
<ItemGroup>
  <Reference Include="R_APICommonDTO">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_APICommonDTO.dll</HintPath>
  </Reference>
  <Reference Include="R_CommonFrontBackAPI">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_CommonFrontBackAPI.dll</HintPath>
  </Reference>
  <Reference Include="R_BlazorFrontEnd">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_BlazorFrontEnd.dll</HintPath>
  </Reference>
  <Reference Include="R_BlazorFrontEnd.Controls">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Front\R_BlazorFrontEnd.Controls.dll</HintPath>
  </Reference>
  <Reference Include="BlazorClientHelper">
    <HintPath>..\..\..\..\SYSTEM\SOURCE\LIBRARY\Menu\BlazorClientHelper.dll</HintPath>
  </Reference>
</ItemGroup>
```

**Optional DLLs (add only if needed):**
- **Back**: BackExtension (for menu integration)
- **Model**: R_BlazorFrontEnd.Excel, R_ProcessAndUploadFront (for Excel/upload features)
- **Front**: Additional R_BlazorFrontEnd.* libraries (for specific UI components)

**ALL DLL references must be verified BEFORE attempting build.**

## UI/Data Binding Patterns (Critical - October 2025)

### Date Field Handling
- [ ] All string date fields from service (C*_DATE) mapped to nullable DateTime in DTOs (D*_DATE)
- [ ] UI bound to R_DatePicker using D*_DATE properties
- [ ] R_GetEntity uses `R_FrontUtility.R_ConvertToDateTime()` to populate D*_DATE from C*_DATE
- [ ] Date format passed to R_ConvertToDateTime matches "yyyyMMdd" unless stated otherwise

### Conductor
- [ ] Must fill R_ViewModel parameter in R_Conductor
- [ ] No manual state management for conductor-driven fields
- [ ] R_Init_From_Master get entity with R_GetEntity (not fetching data directly)
- [ ] R_GetEntity called in R_Conductor to populate fields

### Grid
- [ ] Grid data fetched in grid's R_ServiceGetListRecord method
- [ ] R_Init_From_Master captures parameters only
- [ ] R_Init_From_Master refreshes grid (not fetching data directly)

### Layout Spacing
- [ ] In R_StackLayout rows, last R_ItemLayout has `auto="false"`
- [ ] Prevents overflow issues due to automatic spacing

### Grid Column Type Safety
- [ ] Numeric grid columns use explicit TValue (e.g., `TValue="decimal"`)
- [ ] Correct component namespaces imported (R_BlazorFrontEnd.Controls)
- [ ] Editor component types match column data types

## Component Parameter Validation (Rule #24 - CRITICAL)

### R_ComboBox Parameters
- [ ] Uses `Data` (NOT `DataSource`)
- [ ] Uses `@bind-Value` by default
- [ ] Uses `Value` and `ValueChanged` event handler, if need extra logic on value changed
- [ ] NO explicit `TItem`/`TValue` unless absolutely required
- [ ] Check working examples before guessing parameters

### R_Grid Parameters
- [ ] Inquiry programs: `R_GridType="@R_eGridType.Original"` (NO conductor)
- [ ] CRUD in Form programs: `R_GridType="@R_eGridType.Navigator"` `R_ConductorSource=@_conductorRef` (WITH conductor)
- [ ] CRUD in Grid programs: `R_GridType="@R_eGridType.Original"` `R_ConductorGridSource=@_conductorGridRef` (WITH conductor)
- [ ] Correct `R_ServiceGetListRecord` method signature
- [ ] NO explicit `TModel`

### R_Conductor Usage
- [ ] ONLY used for CRUD operations in form (Add/Edit/Delete)
- [ ] NOT used for inquiry-only programs

## Exception Handling Validation (Rule #25 - MANDATORY)

### Standard Pattern
- [ ] Uses `var loEx = new R_Exception();`
- [ ] Try/catch with `loEx.Add(ex);`
- [ ] Ends with `loEx.ThrowExceptionIfErrors();`
- [ ] NO custom exception handling patterns

### Null Safety
- [ ] Nullable reference types properly handled (`R_Grid? _gridRef`)
- [ ] Null checks before method calls (`if (_gridRef != null)`)
- [ ] No unnecessary casting or type conversions

## Warning Handling Validation (Rule #26 - MANDATORY)

### Warning Classification
- [ ] All warnings identified and classified by type
- [ ] Code warnings (CS####) fixed immediately
- [ ] External warnings (NU####, MSB####) documented with explanation
- [ ] Infrastructure warnings marked as acceptable with reason

### Build Report Requirements
- [ ] Warning count reported for each project
- [ ] Warning types categorized (Code/External/Infrastructure)
- [ ] External warnings explained why they cannot be fixed
- [ ] NO claims of "warnings are fine" without analysis

### Warning Response Protocol
- [ ] First: Identify warning type and source
- [ ] Code Warnings: Fix immediately - no exceptions
- [ ] External Warnings: Document in build report with explanation
- [ ] Never: Claim "warnings are acceptable" without classification
- [ ] Always: Report warning count and types in build summary

## Final Checks
- [ ] All projects reference correct DLLs from `.cursor/docs/net6/`
- [ ] All .csproj files validated for correct structure
- [ ] Build order followed: Common → Back/Resources → Service → Front
- [ ] No compilation errors
- [ ] No hardcoded error messages (all from resources)
- [ ] No SQL queries modified
- [ ] No SP names changed
- [ ] Behavioral parity confirmed with original .NET 4 code
- [ ] All unit tests pass
- [ ] All integration tests pass

---