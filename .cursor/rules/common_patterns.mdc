---
alwaysApply: false
priority: HIGH
glob: "*ToCSharpCommon*"
---

# COMMON LAYER PATTERNS

## DLL References (Minimal)
```xml
<ItemGroup>
  <Reference Include="R_APICommonDTO">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_APICommonDTO.dll</HintPath>
  </Reference>
  <Reference Include="R_CommonFrontBackAPI">
    <HintPath>..\..\..\..\..\SYSTEM\SOURCE\LIBRARY\Back\R_CommonFrontBackAPI.dll</HintPath>
  </Reference>
</ItemGroup>
```

## Interface Pattern
```csharp
public interface I{ProgramName} : R_IServiceCRUDAsyncBase<{ProgramName}DTO>
{
    // Streaming patterns - NO parameters
    // Must create GetStreamingListParameterDTO because it will be used by method in `{ProgramName}Cls.cs`
    IAsyncEnumerable<GetStreamingListResultDTO> GetStreamingList();
    
    // Non-streaming Patterns - WITH parameters
    Task<{ProgramName}ResultDTO<GetNonStreamingResultDTO>> GetNonStreaming(GetNonStreamingParameterDTO poParameter);

    // Non-streaming methods - WITHOUT parameters
    // Must create GetNonStreamingParameterDTO because it will be used by method in `{ProgramName}Cls.cs`
    Task<{ProgramName}ResultDTO<GetNonStreamingResultDTO>> GetNonStreaming();
}
```
**CRITICAL**: Use `R_IServiceCRUDAsyncBase` NOT `R_IServiceCRUDBase`, must not use `Async` as suffix.

## Context Constants Patterns
**CRITICAL:** All context constants must use "{ProgramName}_" prefix in the **values** for namespace collision avoidance

### Context Constants Pattern
```csharp
public static class ContextConstants
{
    /// <summary>
    /// Soft period context key
    /// </summary>
    public const string SOFT_PERIOD = "{ProgramName}_CSOFT_PERIOD";

    /// <summary>
    /// Department code context key
    /// </summary>
    public const string DEPT_CODE = "{ProgramName}_CDEPT_CODE";
}
```

### Requirements
- **MUST:** Use exact program name prefix in the **string values** (e.g., `"FAI00130_CSOFT_PERIOD"`)
- **MUST:** Keep variable names simple and descriptive (e.g., `SOFT_PERIOD`, `DEPT_CODE`)
- **MUST:** Document each constant with XML comments
- **NEVER:** Use generic values without program prefix
- **NEVER:** Change the database field names in the prefix

### Violations
- ❌ Using generic values like `"CSOFT_PERIOD"` instead of `"FAI00130_CSOFT_PERIOD"`
- ❌ Missing XML documentation for constants
- ❌ Using program prefix in variable names instead of values

## DTO Design Patterns - MANDATORY
**CRITICAL:** Each method gets its own specific parameter DTO, not generic DTOs

### DTO Design Rules
- **Specific Parameter DTOs:** Each method gets its own parameter DTO
- **Property Naming:** Must match VB.NET exactly (`CTRANS_DEPT_CODE`, not `TransDeptCode`)
- **Required Properties:** All properties that VB.NET accesses must exist in C# DTOs
- **Default Values:** Use `string.Empty` for string properties to avoid null issues

### Correct Pattern
```csharp
// ✅ CORRECT - Specific parameter DTO
public class FAI00130GetSystemVariablesParameterDTO
{
    public string CCOMPANY_ID { get; set; } = string.Empty;
    public string CUSER_ID { get; set; } = string.Empty;
    public string CTRANS_DEPT_CODE { get; set; } = string.Empty;
}

// ❌ WRONG - Generic DTO for everything
public class FAI00130DTO // Used for all parameters
```

### Violations
- ❌ Using generic `{ProgramName}DTO` for all parameters
- ❌ Missing properties that VB.NET accesses
- ❌ Using PascalCase instead of VB.NET naming (`CTRANS_DEPT_CODE`)

